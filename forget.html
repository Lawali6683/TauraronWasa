<!DOCTYPE html>
<html lang="ha">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manta Kalmar Sirri - TauraronWasa</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #a865ff;
      --secondary: #ffad97;
      --bg1: #180022;
      --bg2: #300040;
      --accent: #fff176;
      --push-bg: #22102d;
      --push-border: #fff176;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, var(--bg1), var(--bg2));
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-size: cover;
      color: #ffffff;
      min-height: 100vh;
      position: relative;
    }
    .tauraronwasa-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }
    .tauraronwasa-bg svg {
      width: 100vw;
      height: 100vh;
      display: block;
    }
    .container {
      max-width: 360px;
      margin: 70px auto 0 auto;
      padding: 2.3rem 1.5rem 2rem 1.5rem;
      background: rgba(24,0,34,0.72);
      border-radius: 18px;
      box-shadow: 0px 8px 32px #20004780;
      border: 1.2px solid var(--primary);
      position: relative;
      z-index: 2;
      animation: fadeUp .8s cubic-bezier(.38,.75,.32,1.2);
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(40px);}
      to   { opacity: 1; transform: translateY(0);}
    }
    .container h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 12px;
      font-weight: 600;
      color: var(--primary);
      letter-spacing: 0.5px;
    }
    .container p {
      font-size: 1rem;
      text-align: center;
      color: #e0d7ec;
      margin-bottom: 16px;
    }
    .container input[type="email"] {
      width: 100%;
      padding: 11px 12px;
      margin: 10px 0 8px 0;
      border: 1.7px solid var(--primary);
      border-radius: 6px;
      background: rgba(255,255,255,0.06);
      color: #fff;
      font-size: 1rem;
      outline: none;
      transition: border 0.2s;
      box-sizing: border-box;
      font-family: inherit;
    }
    .container input[type="email"]:focus {
      border-color: var(--accent);
      background: rgba(255,255,255,0.11);
    }
    .container button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #1e0032;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s, color 0.2s;
      box-shadow: 0 2px 12px #7e00ff36;
    }
    .container button:hover {
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      color: #fff;
    }
    .logo-block { margin-bottom: 15px; text-align: center;}
    .logo-block img {
      width: 88px;
      filter: drop-shadow(0 2px 14px #a865ff99);
      margin-bottom: 5px;
    }
    /* Push Container for user feedback */
    .push-container {
      display: none;
      position: fixed;
      left: 50%;
      top: 12%;
      transform: translateX(-50%);
      min-width: 320px;
      max-width: 90vw;
      background: var(--push-bg);
      border: 2px solid var(--push-border);
      color: #fff;
      padding: 1.2rem 1.1rem;
      border-radius: 13px;
      z-index: 1111;
      font-size: 1.08rem;
      box-shadow: 0 4px 28px #14002b99;
      animation: fadePush .5s;
      text-align: center;
    }
    @keyframes fadePush {
      from { opacity:0; transform:translateY(-30px);}
      to   { opacity:1; transform:translateY(0);}
    }
    .push-close {
      position: absolute;
      top: 8px; right: 13px;
      background: transparent;
      color: #fff176;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }
    /* Preloader */
    #preloader {
      position: fixed;
      inset: 0;
      background: linear-gradient(to bottom, var(--bg1), var(--bg2));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      flex-direction: column;
      transition: opacity 0.4s;
    }
    #preloader .loader {
      width: 50px; height: 50px;
      border: 6px solid #fff4;
      border-top: 6px solid var(--accent);
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
      margin-bottom: 12px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    #preloader span {
      color: var(--accent);
      font-size: 1.1rem;
      font-weight: 500;
      letter-spacing: 0.2px;
    }
    @media (max-width: 480px) {
      .container { margin: 40px 5vw 0 5vw; padding: 1.5rem 0.7rem 1.1rem 0.7rem;}
      .push-container { min-width: 200px;}
    }
  </style>
</head>
<body>
  <div class="tauraronwasa-bg" aria-hidden="true">
    <!-- SVG Background: Stars + Faint planet -->
    <svg viewBox="0 0 1920 1080" fill="none">
      <circle cx="1550" cy="200" r="180" fill="#fff17622"/>
      <circle cx="500" cy="900" r="120" fill="#a865ff22"/>
      <g>
        <circle cx="180" cy="150" r="2.2" fill="#fff"/>
        <circle cx="400" cy="390" r="1.7" fill="#fff"/>
        <circle cx="1330" cy="540" r="2.5" fill="#fff"/>
        <circle cx="1000" cy="220" r="1.2" fill="#fff"/>
        <circle cx="1700" cy="800" r="1.9" fill="#fff"/>
        <circle cx="900" cy="910" r="1.5" fill="#fff"/>
        <circle cx="1200" cy="800" r="1.3" fill="#fff"/>
        <circle cx="400" cy="650" r="1.9" fill="#fff"/>
        <circle cx="1800" cy="420" r="2.1" fill="#fff"/>
      </g>
    </svg>
  </div>
  <div id="preloader">
    <div class="loader"></div>
    <span>Ana lodin...</span>
  </div>
  <div class="logo-block">
    <img src="logo.png" alt="TauraronWasa" loading="lazy">
  </div>
  <div class="container" id="mainFormContainer">
    <h1>Manta Kalmar Sirri</h1>
    <p>Shigar da imel ɗinka da aka yi rijista da shi domin samun hanyar sabunta kalmar sirrinka.</p>
    <form id="forgotForm" autocomplete="off">
      <input type="email" id="forgotEmail" placeholder="Shigar da imel ɗinka" required autocomplete="email">
      <button type="submit" id="sendBtn">Aika Hanyar Sabuntawa</button>
    </form>
  </div>
  <div class="push-container" id="pushContainer" role="alert">
    <button class="push-close" id="closePush" aria-label="Rufe">×</button>
    <span id="pushMsg"></span>
  </div>
  <script type="module">
    // Preloader logic
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('preloader').style.opacity = "0";
        setTimeout(() => document.getElementById('preloader').style.display = "none", 400);
      }, 350);
    });

    // Lazy Fade-up effect using IntersectionObserver
    document.addEventListener('DOMContentLoaded', () => {
      const obs = new window.IntersectionObserver((entries, obsr) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = "1";
            entry.target.style.transform = "none";
            obsr.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15 });

      document.querySelectorAll('.container').forEach(el => {
        el.style.opacity = "0";
        el.style.transform = "translateY(40px)";
        obs.observe(el);
      });
    });

    // Push Container Feedback
    function showPush(msg, timeout = 0) {
      const push = document.getElementById('pushContainer');
      document.getElementById('pushMsg').innerHTML = msg;
      push.style.display = "block";
      setTimeout(() => { push.focus && push.focus(); }, 100);
      if (timeout > 0) setTimeout(() => { push.style.display = "none"; }, timeout);
    }
    document.getElementById('closePush').onclick = () => {
      document.getElementById('pushContainer').style.display = "none";
    };

    // Main form logic (Firebase)
    import { app, firebaseConfig } from './firebase.js';
    import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";
    const auth = getAuth(app);
    const database = getDatabase(app);

    const forgotForm = document.getElementById('forgotForm');
    const mainFormContainer = document.getElementById('mainFormContainer');
    const emailInput = document.getElementById('forgotEmail');
    const sendBtn = document.getElementById('sendBtn');
    let submitting = false;

    forgotForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (submitting) return;
      submitting = true;
      sendBtn.disabled = true;
      sendBtn.textContent = "Ana aiki...";
      const email = emailInput.value.trim();

      // Bincika ko imel din ya yi rijista
      const dbRef = ref(database);
      get(child(dbRef, `users`)).then((snapshot) => {
        if (snapshot.exists()) {
          const users = snapshot.val();
          const emailExists = Object.values(users).some((user) => user.email === email);
          if (emailExists) {
            // Aika email na sabunta password
            sendPasswordResetEmail(auth, email)
              .then(() => {
                mainFormContainer.style.display = "none";
                showPush(
                  "An aiko maka da hanyar sabunta kalmar sirri a cikin imel ɗinka. <br><b>Ka duba imel ɗinka yanzu</b>.<br>Idan ba ka ga sako ba a cikin minti 2, ka duba 'Spam' ko 'Junk'.",
                  0
                );
              })
              .catch((error) => {
                showPush("Kuskure wajen aika sako: <br>" + error.message, 0);
              })
              .finally(() => {
                submitting = false;
                sendBtn.disabled = false;
                sendBtn.textContent = "Aika Hanyar Sabuntawa";
              });
          } else {
            showPush("Wannan imel ɗin bai yi rijista ba a TauraronWasa.", 0);
            submitting = false;
            sendBtn.disabled = false;
            sendBtn.textContent = "Aika Hanyar Sabuntawa";
          }
        } else {
          showPush("Ba a samu bayanan masu amfani ba.", 0);
          submitting = false;
          sendBtn.disabled = false;
          sendBtn.textContent = "Aika Hanyar Sabuntawa";
        }
      }).catch((error) => {
        showPush("Kuskure wajen duba bayanai: <br>" + error.message, 0);
        submitting = false;
        sendBtn.disabled = false;
        sendBtn.textContent = "Aika Hanyar Sabuntawa";
      });
    });
  </script>
</body>
</html>