<!DOCTYPE html>
<html lang="ha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayanin Kungiyoyin Kwallon Kafa - Tauraron Wasa</title>
    <link rel="icon" href="https://i.imgur.com/CgvdgMA.png" type="image/png">
    <style>
        *, *::before, *::after {
            box-sizing: border-box; 
        }

        :root {
            --bg: #0e0e0e;
            --bg-glass: rgba(30,30,30,0.85);
            --fg: #f4f4f4;
            --accent: #16e7cf;
            --secondary: #ff9100;
            --danger: #ff4d4d;
            --card-radius: 18px;
            --card-shadow: 0 8px 30px rgba(0,0,0,0.4);
            --transition: all 0.3s cubic-bezier(.75,.16,.47,1.13);
            --table-header: #212121;
            --table-row-alt: #191919;
            --table-border: #252525;
            --default-crest: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg); 
            color: var(--fg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            width: 100%; 
        }
        
        .loading-backdrop {
            position: fixed; z-index: 9000; inset: 0;
            background: linear-gradient(to bottom, #180022, #300040);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.3s, visibility 0.3s; text-align: center; padding: 1em;
        }
        .loading-backdrop.hidden {
            opacity: 0; visibility: hidden; pointer-events: none;
        }
        .lds-roller { display: inline-block; position: relative; width: 72px; height: 72px; }
        .lds-roller div { animation: lds-roller 1.2s cubic-bezier(0.6, 0, 0.6, 1) infinite; transform-origin: 36px 36px; }
        .lds-roller div:after { content: " "; display: block; position: absolute; width: 8px; height: 8px; border-radius: 50%; background: var(--accent); margin: -4px 0 0 -4px; }
        .lds-roller div:nth-child(1) { animation-delay: -0.036s; top: 63px; left: 63px; }
        .lds-roller div:nth-child(8) { animation-delay: -0.288s; top: 56px; left: 12px; }
        @keyframes lds-roller {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }

        header {
            width: 100%;
            background: var(--bg-glass);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(8px);
            padding-bottom: 5px; 
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 20px 10px;
        }

        .logo-container img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }

        .logo-container h1 {
            font-size: 1.8rem;
            color: var(--accent);
            margin: 0;
            font-weight: 900;
            text-shadow: 0 0 5px rgba(22, 231, 207, 0.5);
        }

        .teams-menu {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 10px 20px; 
            gap: 12px;
            max-width: 100%;
            background: var(--bg); 
            border-top: 1px solid var(--table-border);
            box-shadow: inset 0 0 8px rgba(0,0,0,0.8);
            scroll-behavior: smooth;
        }
        
        .teams-menu::-webkit-scrollbar { height: 5px; }
        .teams-menu::-webkit-scrollbar-thumb { background-color: var(--accent); border-radius: 10px; }
        .teams-menu::-webkit-scrollbar-track { background: var(--bg-glass); }

        .team-btn {
            width: 150px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 10px 5px; background: var(--table-header);
            border: 1px solid var(--table-border); border-radius: 12px;
            color: var(--fg); cursor: pointer; font-weight: 600; font-size: 0.85em;
            text-align: center; white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis; transition: var(--transition); flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            height: 90px;
        }
        
        .team-btn:hover {
            background: linear-gradient(145deg, var(--table-header), #2b2b2b);
            border-color: var(--accent); transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(22, 231, 207, 0.3);
        }

        .team-btn.active {
            background: linear-gradient(135deg, var(--accent), #00a08e);
            color: var(--bg); border-color: #fff; transform: scale(1.05);
            box-shadow: 0 0 25px rgba(22, 231, 207, 0.8);
        }

        .team-btn img {
            width: 30px; height: 40px; margin-bottom: 5px; object-fit: contain;
            background: var(--default-crest); border-radius: 50%; padding: 2px;
            border: 2px solid transparent; transition: var(--transition);
        }
        
        .team-btn.active img { filter: brightness(0.2); border-color: var(--bg); }
        .team-btn span { 
            overflow: hidden; 
            text-overflow: ellipsis; 
            width: 100%; 
            padding: 0 2px;
            white-space: pre-wrap;
            line-height: 1.2;
            max-height: 2.4em;
        }

        main {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            flex-grow: 1;
        }

        .info-container {
            background: var(--bg-glass); border-radius: var(--card-radius);
            box-shadow: var(--card-shadow); padding: 25px; min-height: 400px;
            display: none; flex-direction: column; gap: 20px;
        }
        
        .info-container.show { display: flex; }
        
        .team-details, .player-details { display: none; }
        .team-details.show, .player-details.show { display: block; }
        
        .page-intro { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 50vh; text-align: center; padding: 30px; background: var(--bg-glass);
            border-radius: var(--card-radius); box-shadow: var(--card-shadow); border: 1px solid var(--accent);
        }
        .page-intro h2 { font-size: 2rem; color: var(--accent); margin-bottom: 10px; }
        .page-intro p { font-size: 1.1em; color: #ccc; max-width: 600px; }
        .page-intro .icon-guide { font-size: 3rem; color: var(--secondary); animation: pulse 1.5s infinite; margin-top: 20px; }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

     
.team-history-card, .player-history-card { 
    background: linear-gradient(135deg, #1f1f1f, #141414);
    border: 2px solid var(--secondary);
    border-radius: var(--card-radius);
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}
.team-history-card h3, .player-history-card h3 {
    color: var(--secondary);
    font-size: 1.6rem;
    border-bottom: 2px dashed #333;
    padding-bottom: 10px;
    margin-top: 0;
}
.team-history-card p, .player-history-card p {
 font-size: 1rem;
    font-weight: 500;
    color: inherit;   
    line-height: 1.4;
    margin: 0.5rem 0;
    white-space: pre-wrap;
    
    
}
.player-card.no-photo {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 160px;
}
.player-card.no-photo img {
    display: none;
}
.player-card.no-photo .player-position {
    margin-top: 10px;
}

.match-card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 20px;
}
.match-card {
    background: var(--bg-glass); 
    border-radius: var(--card-radius);
    border: 1px solid #00ffcc;
    padding: 15px; 
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
    transition: transform 0.2s, box-shadow 0.2s;
    
    justify-content: space-between; 
    min-height: 180px;
}
.match-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 30px rgba(0, 255, 204, 0.2);
}
.teams {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
    width: 100%;
}
.team {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    min-width: 0; 
}
.team .crest {
    width: 50px; 
    height: 50px;
    margin-bottom: 0.5rem;
    object-fit: contain;
    background: var(--table-header);
    border-radius: 6px;
    border: 1.5px solid #fff1;
    padding: 3px; 
}
.team span {
    font-weight: bold;
    font-size: 0.9em; 
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    max-width: 100px;
}

.vs-score {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 80px;
    min-width: 80px;
}
.score-container {
    display: flex;
    align-items: center;
    gap: 5px;
}
.score {
    font-size: 2.0rem; 
    font-weight: 700;
    color: var(--accent);
    padding: 0 2px;
}
.separator {
    font-size: 1.8rem;
    font-weight: 300;
    color: #666;
}


.vs-score-container {
    height: 40px; 
    justify-content: center;
    align-items: center;
}
.vs-text {
    font-size: 1.4rem;
    font-weight: 700;
    color: #ffd858; 
    text-shadow: 0 0 5px rgba(255, 216, 88, 0.4);
}


.match-competition {
    font-size: 0.8em;
    color: var(--secondary);
    font-weight: 600;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dashed #333;
    width: 90%;
}
.match-status {
    font-weight: 600;
    font-size: 0.9em;
    padding: 4px 0;
}
.match-info.time {
    font-size: 0.95em;
    font-weight: 500;
    color: #aaa;
    margin-top: 5px;
}


.status.finished { color: #9eff9e; } 
.status.live { color: var(--accent); } 
.status.scheduled { color: #58a0ff; } 
.status.default { color: #aaa; } 
        
        .show-more-btn {
            display: block;
            width: fit-content;
            margin: 30px auto 0;
            padding: 12px 25px;
            background: linear-gradient(45deg, var(--accent), #00a08e); 
            color: var(--bg); 
            border: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            transition: var(--transition);
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(22, 231, 207, 0.4);
        }
        .show-more-btn:hover {
            background: linear-gradient(45deg, #00a08e, var(--accent));
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 6px 20px rgba(22, 231, 207, 0.6);
        }
        .hidden {
            display: none !important;
        }

        .team-header { display: flex; align-items: center; gap: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--table-border); }
        .team-header img { width: 80px; height: 80px; object-fit: contain; }
        .team-header h2 { margin: 0; font-size: 2.5rem; color: var(--accent); }
        .team-data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .data-card { background: var(--table-header); padding: 15px; border-radius: 10px; border-left: 5px solid var(--accent); }
        .players-section h3 { color: var(--accent); border-bottom: 1px solid var(--table-border); padding-bottom: 5px; margin-top: 30px; font-size: 1rem; }
        .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .player-card { 
            background: var(--table-row-alt); padding: 10px; border-radius: 10px; text-align: center; cursor: pointer; 
            transition: var(--transition); border: 1px solid var(--table-border); min-height: 160px;
        }
        .player-card:hover { background: var(--table-header); transform: scale(1.05); box-shadow: 0 0 15px rgba(22, 231, 207, 0.2); }
        .player-card img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent); margin-bottom: 5px; background: var(--default-crest); }
        .player-card .player-name { font-weight: bold; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .back-to-team-btn { padding: 10px 20px; background-color: var(--danger); color: var(--fg); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; margin-bottom: 20px; display: block; width: fit-content; }
        
        .player-info-header { 
            display: flex; align-items: center; gap: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--table-border); 
            margin-bottom: 20px;
        }
        .player-info-header img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid var(--secondary); }
        .player-info-header h3 { margin: 0; font-size: 1rem; color: var(--accent); }
        .player-info-header p { margin: 0; color: #aaa; font-size: 1.1em; }
        .player-details-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;
        }
        .detail-item {
            background: var(--table-header); padding: 15px; border-radius: 10px; border-left: 5px solid var(--secondary);
        }

        @media (max-width: 768px) {
            .logo-container h1 { font-size: 2rem; }
            .team-btn { width: 100px; font-size: 0.6em; font-weight: bold;}
            .team-btn img { width: 40px; height: 40px; }
            .team-header h2 { font-size: 1.8rem; }
            .teams-menu { padding: 10px 10px; gap: 8px; }
            main { padding: 10px; }
            .player-info-header { flex-direction: column; text-align: center; }
            .team-btn { height: 80px; }
        }
        
                
         .lds-roller div:nth-child(1) { animation-delay: -0.036s; top: 63px; left: 63px; }
    .lds-roller div:nth-child(2) { animation-delay: -0.072s; top: 68px; left: 56px; }
    .lds-roller div:nth-child(3) { animation-delay: -0.108s; top: 71px; left: 48px; }
    .lds-roller div:nth-child(4) { animation-delay: -0.144s; top: 72px; left: 39px; }
    .lds-roller div:nth-child(5) { animation-delay: -0.18s; top: 71px; left: 31px; }
    .lds-roller div:nth-child(6) { animation-delay: -0.216s; top: 68px; left: 24px; }
    .lds-roller div:nth-child(7) { animation-delay: -0.252s; top: 63px; left: 17px; }
    .lds-roller div:nth-child(8) { animation-delay: -0.288s; top: 56px; left: 12px; }
    @keyframes lds-roller {
        0% { transform: rotate(0deg);}
        100% { transform: rotate(360deg);}
    }
    
    </style>
</head>
<body>

    <div class="loading-backdrop hidden" id="loading-backdrop">
        <div class="lds-roller">
            <div></div><div></div><div></div><div></div>
            <div></div><div></div><div></div><div></div>
        </div>
      
</div>
    <header>
        <div class="logo-container">
            <img src="https://i.imgur.com/CgvdgMA.png" alt="Logo">
            <h1>Tauraron Wasa</h1>
        </div>
        
        <div class="teams-menu" id="teams-menu">
        </div>
    </header>

    <main>
        
        <div class="page-intro" id="page-intro">
            <h2>Sannu!</h2>
            <p>Da fatan za'a zaɓi ɗaya daga cikin manyan ƙungiyoyin da ke sama don ganin cikakken bayani, tarihin ƙungiyar, 'yan wasa, da wasannin da suka buga/za su buga.</p>
            <span class="icon-guide">👆</span>
        </div>

        <div class="info-container" id="info-container">
            
            <div class="team-details" id="team-details">
                <div class="team-header" id="team-header">
                </div>

                <div class="team-history-card hidden" id="team-history-card">
                    <h3>Takataccen Tarihin Ƙungiyar </h3>
                    <div id="team-history-content"></div>
                    <div class="loading-animation" id="history-loading-animation" style="text-align:center;">
                        <img src="https://i.imgur.com/8x8S22y.gif" alt="Loading" style="width: 50px; margin: 10px 0;">
                        <p style="color:var(--secondary); font-size: 0.9em;">Ana Neman Bayanin Tarihi...</p>
                    </div>
                </div>
                
                <section class="team-data-grid" id="team-data-grid">
                </section>
                
                <section class="players-section">
                    <h3>'Yan Wasa na Kungiyar</h3>
                    <div class="players-grid" id="players-grid">
                    </div>
                </section>
                
                <section class="matches-section">
                    <h3>Wasannin da aka Buga, da kuma Wanda Za'a Buga</h3>
                    <div class="match-card-grid" id="matches-grid">
                    </div>
                    <button class="show-more-btn hidden" id="show-more-matches">Nuna Ƙarin Wasanni Duka</button>
                </section>
            </div>
            
            <div class="player-details" id="player-details">
                <button class="back-to-team-btn" id="back-to-team-btn">Komawa Bayanin Ƙungiya</button>
                <div class="player-detail-card">
                    <div class="player-info-header" id="player-info-header">
                    </div>
                    <div class="team-history-card" style="margin-top: 20px;" id="player-history-card">
                        <h3>Tarihin Dan Wasa (Fito Daga AI)</h3>
                        <div id="player-history-content"></div>
                        <div class="loading-animation" id="player-history-loading-animation" style="text-align:center;">
                            <img src="https://i.imgur.com/8x8S22y.gif" alt="Loading" style="width: 50px; margin: 10px 0;">
                            <p style="color:var(--secondary); font-size: 0.9em;">Ana Neman Bayanin Tarihi...</p>
                        </div>
                    </div>

                    <div class="player-details-grid" id="player-details-grid">
                    </div>
                </div>
            </div>

        </div>
        <p id="error-message" style="color:var(--danger); font-weight:bold; text-align:center; display:none; margin-top: 50px; font-size: 1.2em;">An samu matsala wajen ɗauko bayanai. Da fatan za'a sake gwadawa daga baya.</p>
    </main>

    <script>
        
     const WORKER_BASE_URL = "https://tauraronwasaadmin.pages.dev/api/teams"; 
const API_KEY = "@haruna66"; 
const MAX_MATCHES_TO_SHOW = 5;


const teamsData = [
    { name: "Real Madrid", crest: "https://upload.wikimedia.org/wikipedia/en/5/56/Real_Madrid_CF.svg", id: 86 }, 
    { name: "Manchester United", crest: "https://upload.wikimedia.org/wikipedia/en/7/7a/Manchester_United_FC_crest.svg", id: 66 }, 
    { name: "Barcelona", crest: "https://upload.wikimedia.org/wikipedia/en/4/47/FC_Barcelona_%28crest%29.svg", id: 81 }, 
    { name: "Chelsea", crest: "https://upload.wikimedia.org/wikipedia/en/c/cc/Chelsea_FC.svg", id: 61 }, 
    { name: "Liverpool", crest: "https://upload.wikimedia.org/wikipedia/en/0/0c/Liverpool_FC.svg", id: 64 }, 
    { name: "Arsenal", crest: "https://upload.wikimedia.org/wikipedia/en/5/53/Arsenal_FC.svg", id: 57 }, 
    { name: "Manchester City", crest: "https://upload.wikimedia.org/wikipedia/en/e/eb/Manchester_City_FC_badge.svg", id: 65 }, 
    { name: "AC Milan", crest: "https://upload.wikimedia.org/wikipedia/commons/d/d0/Logo_of_AC_Milan.svg", id: 98 }, 
    { name: "Paris Saint-Germain", crest: "https://upload.wikimedia.org/wikipedia/en/a/a7/Paris_Saint-Germain_F.C..svg", id: 524 }, 
    { name: "Tottenham Hotspur", crest: "https://upload.wikimedia.org/wikipedia/en/b/b4/Tottenham_Hotspur.svg", id: 73 }, 
    { name: "Borussia Dortmund", crest: "https://upload.wikimedia.org/wikipedia/commons/6/67/Borussia_Dortmund_logo.svg", id: 4 }, 
    { name: "AS Roma", crest: "https://upload.wikimedia.org/wikipedia/en/f/f7/AS_Roma_logo_%282017%29.svg", id: 100 }, 
    { name: "Ajax", crest: "https://upload.wikimedia.org/wikipedia/en/7/79/Ajax_Amsterdam.svg", id: 3 }, 
    { name: "Leicester City", crest: "https://upload.wikimedia.org/wikipedia/en/2/2d/Leicester_City_crest.svg", id: 338 }, 
    { name: "Everton", crest: "https://upload.wikimedia.org/wikipedia/en/7/7c/Everton_FC_logo.svg", id: 62 }, 
    { name: "Valencia", crest: "https://upload.wikimedia.org/wikipedia/en/c/ce/Valenciacf.svg", id: 90 }, 
    { name: "West Ham United", crest: "https://upload.wikimedia.org/wikipedia/en/c/c2/West_Ham_United_FC_logo.svg", id: 563 }, 
    { name: "Inter Milan", crest: "https://upload.wikimedia.org/wikipedia/commons/0/05/FC_Internazionale_Milano_2021.svg", id: 108 }, 
    { name: "Atletico Madrid", crest: "https://i.imgur.com/B7Lkdmh.png", id: 92 }, 
    { name: "Bayern Munich", crest: "https://i.imgur.com/rMkzULt.png", id: 5 }, 
    { name: "Napoli", crest: "https://i.imgur.com/qdZR69v.png", id: 113 }, 
    { name: "Juventus", crest: "https://i.imgur.com/M8hB4NN.png", id: 109 }, 
    { name: "Sevilla", crest: "https://i.imgur.com/hY4lfmA.png", id: 559 }, 
    { name: "Benfica", crest: "https://i.imgur.com/iatwLH3.png", id: 1903 }, 
];
    
let currentTeamId = null;
let currentTeamCrest = null;

const elements = {
    loadingBackdrop: document.getElementById('loading-backdrop'),
    teamsMenu: document.getElementById('teams-menu'),
    infoContainer: document.getElementById('info-container'),
    pageIntro: document.getElementById('page-intro'),
    teamDetails: document.getElementById('team-details'),
    playerDetails: document.getElementById('player-details'),
    teamHeader: document.getElementById('team-header'),
    teamDataGrid: document.getElementById('team-data-grid'),
    playersGrid: document.getElementById('players-grid'),
    matchesGrid: document.getElementById('matches-grid'),
    showMoreMatchesBtn: document.getElementById('show-more-matches'),
    backToTeamBtn: document.getElementById('back-to-team-btn'),
    playerInfoHeader: document.getElementById('player-info-header'),
    playerDetailsGrid: document.getElementById('player-details-grid'),
    errorMessage: document.getElementById('error-message'),
    teamHistoryCard: document.getElementById('team-history-card'),
    teamHistoryContent: document.getElementById('team-history-content'),
    historyLoadingAnimation: document.getElementById('history-loading-animation'),
    playerHistoryCard: document.getElementById('player-history-card'),
    playerHistoryContent: document.getElementById('player-history-content'),
    playerHistoryLoadingAnimation: document.getElementById('player-history-loading-animation'),
};

const formatMatchTime = (utcDateStr) => {
    const date = new Date(utcDateStr);
    
    let timePart = date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true }); 
    
    if (timePart.startsWith('0')) {
        timePart = timePart.substring(1);
    }
    
    const datePart = date.toLocaleDateString([], { month: 'numeric', day: 'numeric' });
    
    return `${datePart} @ ${timePart}`; 
};


const formatMatchDate = (utcDateStr) => {
    const date = new Date(utcDateStr);
    return date.toLocaleDateString([], { month: 'short', day: 'numeric', year: 'numeric' }); 
};


const toggleLoading = (show) => {
    elements.loadingBackdrop.classList.toggle('hidden', !show);
};

const displayError = (message) => {
    elements.errorMessage.textContent = message;
    elements.errorMessage.style.display = 'block';
    elements.infoContainer.classList.remove('show');
    elements.pageIntro.classList.remove('hidden');
    elements.teamDetails.classList.remove('show');
    elements.playerDetails.classList.remove('show');
};

const showTeamView = () => {
    elements.playerDetails.classList.remove('show');
    elements.teamDetails.classList.add('show');
    elements.infoContainer.classList.add('show');
    elements.pageIntro.classList.add('hidden');
    elements.errorMessage.style.display = 'none';
};

const showPlayerView = () => {
    elements.teamDetails.classList.remove('show');
    elements.playerDetails.classList.add('show');
    elements.infoContainer.classList.add('show');
    elements.pageIntro.classList.add('hidden');
    elements.errorMessage.style.display = 'none';
};

const fetchAndCacheImage = async (url, cacheKey) => {
    const cachedImage = localStorage.getItem(cacheKey);
    if (cachedImage && cachedImage.startsWith('data:')) {
        return cachedImage;
    }
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Failed to load image');
        }
        const blob = await response.blob();
        
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => {
                const base64data = reader.result;
                try {
                     localStorage.setItem(cacheKey, base64data);
                } catch(e) {
                }
                resolve(base64data);
            };
            reader.onerror = () => resolve(url); 
            reader.readAsDataURL(blob);
        });
    } catch (error) {
        return url; 
    }
};

const renderTeamButtons = () => {
    elements.teamsMenu.innerHTML = ''; 
    
    teamsData.forEach(team => {
        const teamBtn = document.createElement('button');
        teamBtn.className = 'team-btn';
        teamBtn.dataset.teamId = team.id;
        
        const cachedCrest = localStorage.getItem(`crest_${team.id}`);
        const imageSource = cachedCrest && cachedCrest.startsWith('data:') ? cachedCrest : team.crest;

        teamBtn.innerHTML = `
            <img src="${imageSource}" alt="${team.name} crest" data-crest-url="${team.crest}">
            <span>${team.name}</span>
        `;
        
        if (!cachedCrest || !cachedCrest.startsWith('data:')) {
            fetchAndCacheImage(team.crest, `crest_${team.id}`).then(base64Image => {
                const imgElement = teamBtn.querySelector('img');
                if (base64Image.startsWith('data:')) {
                    imgElement.src = base64Image;
                }
            });
        }

        teamBtn.addEventListener('click', (e) => {
            const teamId = e.currentTarget.dataset.teamId;
            if (currentTeamId == teamId) return;

            document.querySelectorAll('.team-btn').forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');

            currentTeamId = teamId;
            const fullTeamData = teamsData.find(t => t.id == teamId); 
            currentTeamCrest = fullTeamData.crest;

            displayTeamDetails(fullTeamData.id, fullTeamData.name, fullTeamData.crest);
            
            e.currentTarget.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        });
        elements.teamsMenu.appendChild(teamBtn);
    });
};

const fetchWorkerAPI = async (action, payload = {}) => {
    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Africa/Lagos'; 
    const body = { action, timeZone, ...payload };
    const endpoint = WORKER_BASE_URL;

    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': API_KEY,
            },
            body: JSON.stringify(body),
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP Error: ${response.status}. Details: ${errorText.substring(0, 100)}...`);
        }

        const data = await response.json();
        if (data.error) {
            throw new Error(data.message);
        }

        return data.data || data; 
    } catch (error) {
        throw new Error(`Kuskure wajen ɗauko bayanai: ${error.message}`);
    }
};

const displayTeamDetails = async (teamId, teamName, teamCrest) => {
    toggleLoading(true);
    elements.teamDataGrid.innerHTML = '';
    elements.playersGrid.innerHTML = '';
    elements.matchesGrid.innerHTML = '';
    elements.showMoreMatchesBtn.classList.add('hidden');
    elements.teamHistoryCard.classList.add('hidden'); 
    elements.teamHistoryContent.innerHTML = '';
    elements.historyLoadingAnimation.style.display = 'block';

    try {
        const data = await fetchWorkerAPI('get_team_details', { teamId, teamName });
        const teamData = data.team;
        const matches = data.matches;
        const history = data.history;

        const cachedCrest = localStorage.getItem(`crest_${teamId}`);
        const finalCrest = cachedCrest && cachedCrest.startsWith('data:') ? cachedCrest : teamCrest;

        elements.teamHeader.innerHTML = `
            <img src="${finalCrest}" alt="${teamData.name} crest">
            <h2>${teamData.name}</h2>
        `;

        const details = [
            { label: "An Kafa", value: teamData.founded || 'N/A' },
            { label: "Kasar", value: teamData.area?.name || 'N/A' },
            { label: "Filin Wasa", value: teamData.venue || 'N/A' },
            { label: "Launin Gida", value: teamData.clubColors || 'N/A' },
        ];
        details.forEach(item => {
            elements.teamDataGrid.innerHTML += `
                <div class="data-card">
                    <h4>${item.label}</h4>
                    <p>${item.value}</p>
                </div>
            `;
        });

        const players = teamData.squad ? teamData.squad.filter(p => p.role === 'PLAYER') : [];
        
        if (players.length === 0) {
             elements.playersGrid.innerHTML = `<p style="color:#aaa; text-align:center;">Ba a samu bayanan 'yan wasa ba a halin yanzu.</p>`;
        }

        players.forEach(player => {
            const playerImage = player.image || ''; 
            const hasPhoto = playerImage.startsWith('http'); 
            const playerCardClass = hasPhoto ? '' : 'no-photo';
            
            elements.playersGrid.innerHTML += `
                <div class="player-card ${playerCardClass}" data-player-id="${player.id}" data-player-name="${player.name}">
                    ${hasPhoto ? `<img src="${playerImage}" alt="${player.name}" onerror="this.onerror=null; this.closest('.player-card').classList.add('no-photo'); this.remove();">` : ''}
                    <div class="player-name">${player.name}</div>
                    <div class="player-position">${player.position || player.role || 'Player'}</div>
                </div>
            `;
        });
        
        displayMatches(matches);
        showTeamView();
        
        elements.teamHistoryCard.classList.remove('hidden');
        elements.historyLoadingAnimation.style.display = 'none';

        if (history && history.message && !history.error) {
            const formattedText = history.message.split('\n').filter(p => p.trim() !== '').map(p => `<p>${p.trim()}</p>`).join('');
            elements.teamHistoryContent.innerHTML = formattedText;
        } else {
             elements.teamHistoryContent.innerHTML = `<p style="color:var(--danger);">Kasa ɗauko bayanin tarihi daga AI: ${history.message || 'Kuskure wajen ɗauko bayanai.'}</p>`;
        }

        document.querySelectorAll('.player-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const pId = e.currentTarget.dataset.playerId;
                const pName = e.currentTarget.dataset.playerName;
                if (pId && pId !== 'undefined' && pId !== 'null') {
                    displayPlayerDetails(pId, pName);
                } else {
                     alert(`Bayanin ${pName} bai nan a API. Da fatan gwada wani dan wasan.`);
                }
            });
        });
    } catch (error) {
        displayError(error.message);
    } finally {
        toggleLoading(false);
    }
};

const displayPlayerDetails = async (playerId, playerName) => {
    toggleLoading(true);
    elements.playerDetailsGrid.innerHTML = '';
    elements.playerInfoHeader.innerHTML = '';
    elements.playerHistoryCard.classList.add('hidden'); 
    elements.playerHistoryContent.innerHTML = '';
    elements.playerHistoryLoadingAnimation.style.display = 'block';

    try {
        const data = await fetchWorkerAPI('get_player_details', { playerId, playerName });
        const player = data.person;
        const history = data.history;
        
        const playerImage = player.image || ''; 
        const playerPhotoSrc = playerImage.startsWith('http') ? playerImage : ''; 
        
        elements.playerInfoHeader.innerHTML = `
            <img src="${playerPhotoSrc}" alt="${player.name}" onerror="this.onerror=null; this.src=''">
            <div class="player-info-text">
                <h3>${player.name}</h3>
                <p>${player.position || player.role || 'Dan Wasa'}</p>
            </div>
        `;
        
        const details = [
            { label: "Kasar", value: player.nationality || 'N/A' },
            { label: "Ranar Haihuwa", value: player.dateOfBirth ? new Date(player.dateOfBirth).toLocaleDateString() : 'N/A' },
            { label: "Kungiyar", value: player.currentTeam?.name || 'Babu Kungiya' },
            { label: "Matsayi", value: player.position || 'N/A' },
            { label: "Lamba", value: player.shirtNumber || 'N/A' },
        ];
        details.forEach(item => {
            elements.playerDetailsGrid.innerHTML += `
                <div class="detail-item">
                    <h4>${item.label}</h4>
                    <p>${item.value}</p>
                </div>
            `;
        });

        showPlayerView();

        elements.playerHistoryCard.classList.remove('hidden');
        elements.playerHistoryLoadingAnimation.style.display = 'none';

        if (history && history.message && !history.error) {
            const formattedText = history.message.split('\n').filter(p => p.trim() !== '').map(p => `<p>${p.trim()}</p>`).join('');
            elements.playerHistoryContent.innerHTML = formattedText;
        } else {
             elements.playerHistoryContent.innerHTML = `<p style="color:var(--danger);">Kasa ɗauko bayanin tarihi daga AI: ${history.message || 'Kuskure wajen ɗauko bayanai.'}</p>`;
        }
    } catch (error) {
        showTeamView(); 
        alert(`An kasa samun cikakken bayani game da ${playerName}: ${error.message}`);
    } finally {
        toggleLoading(false);
    }
};

const displayMatches = (matches, showAll = false) => {
    elements.matchesGrid.innerHTML = '';
    const matchesList = showAll ? matches : matches.slice(0, MAX_MATCHES_TO_SHOW);
    
    matchesList.forEach(match => {
        const homeTeam = match.homeTeam.name || 'N/A';
        const awayTeam = match.awayTeam.name || 'N/A';
        const homeCrest = match.homeTeam.crest || ''; 
        const awayCrest = match.awayTeam.crest || '';
        
        const status = match.status;
        
        const scoreHome = match.score?.fullTime?.home !== null ? match.score.fullTime.home : '-';
        const scoreAway = match.score?.fullTime?.away !== null ? match.score.fullTime.away : '-';

        let infoText = '';
        let statusClass = status.toLowerCase();
        let scoreDisplay = '';
        let extraInfo = '';

        if (['SCHEDULED', 'TIMED'].includes(status)) {
           
            infoText = 'Za a Buga'; 
            extraInfo = formatMatchTime(match.utcDate); 
            scoreDisplay = `<div class="score-container vs-score-container"><span class="vs-text">VS</span></div>`;
            statusClass = 'scheduled';
        } else if (status === 'IN_PLAY' || status === 'PAUSED' || status === 'HALF_TIME') {
           
            const currentScoreHome = match.score?.halfTime?.home !== null ? match.score.halfTime.home : 
                                     match.score?.fullTime?.home !== null ? match.score.fullTime.home : 0;
            const currentScoreAway = match.score?.halfTime?.away !== null ? match.score.halfTime.away :
                                     match.score?.fullTime?.away !== null ? match.score.fullTime.away : 0;
            
            infoText = status === 'HALF_TIME' ? 'Hutu' : 'Yanzu Ana Buga';
            scoreDisplay = `<div class="score-container live-score"><span class="score">${currentScoreHome}</span><span class="separator">-</span><span class="score">${currentScoreAway}</span></div>`;
            statusClass = 'live';
            extraInfo = formatMatchTime(match.utcDate);
        } else if (status === 'FINISHED') {
          
            infoText = 'An Kammala';
            extraInfo = formatMatchDate(match.utcDate);
            scoreDisplay = `<div class="score-container"><span class="score">${scoreHome}</span><span class="separator">-</span><span class="score">${scoreAway}</span></div>`;
            statusClass = 'finished';
        } else {
           
            infoText = status.replace('_', ' ');
            scoreDisplay = `<div class="score-container vs-score-container"><span class="vs-text">VS</span></div>`;
            statusClass = 'default';
            extraInfo = formatMatchDate(match.utcDate); 
        }

        elements.matchesGrid.innerHTML += `
            <div class="match-card">
                <div class="match-competition">${match.competition.name || 'Ba a Sani Ba'}</div>
                <div class="teams">
                    <div class="team home">
                        <img class="crest" src="${homeCrest}" alt="${homeTeam}">
                        <span>${homeTeam}</span>
                    </div>
                    <div class="vs-score">
                        ${scoreDisplay}
                    </div>
                    <div class="team away">
                        <img class="crest" src="${awayCrest}" alt="${awayTeam}">
                        <span>${awayTeam}</span>
                    </div>
                </div>
                <div class="match-status ${statusClass}">${infoText}</div>
                <div class="match-info time">${extraInfo}</div>
            </div>
        `;
    });

    if (matches.length > MAX_MATCHES_TO_SHOW && !showAll) {
        elements.showMoreMatchesBtn.classList.remove('hidden');
        elements.showMoreMatchesBtn.onclick = () => {
             displayMatches(matches, true); 
             elements.showMoreMatchesBtn.classList.add('hidden');
        };
    } else if (showAll) {
         elements.showMoreMatchesBtn.classList.add('hidden');
    }
};

const init = () => {
    renderTeamButtons(); 
    elements.backToTeamBtn.addEventListener('click', showTeamView);
};

document.addEventListener('DOMContentLoaded', init);

    </script>

</body>
</html>